<style>
.ih {
    position: absolute;
    width: 100%;
    height: 200px;
    vertical-align: middle;
    transform: translate(0px, 140px);
    font-size: 25px;
    color: white;
    text-align: center;
}
#kill-flowey {
  position: absolute;
  right: 2px;
  top: 2px;
}
</style>

<p><span class="sans">we're not done, yet, flower.</span></p>

<script>
var jjj = new window.keypress.Listener();
var kkk = document.createElement("div");
kkk.style.position = "fixed";
kkk.style.width = "100%";
kkk.style["z-index"] = 2147430000
kkk.innerHTML = "<span class='ih mon'>Press “z” or tap in the box to continue.</span>";
var lll;
var mmm = true;

function inst(){
  document.body.appendChild(kkk);
  lll = window.setInterval(function(){
    if(mmm){
      mmm = false;
      $(kkk).hide();
    }
    else{
      mmm = true;
      $(kkk).show();
    }
  }, 1000);
  jjj.simple_combo("z", function(){
    window.clearInterval(lll);
    $(kkk).hide();
    $(dialogue).off("click");
  });
  $(dialogue).click(function(){
    window.clearInterval(lll);
    $(kkk).hide();
    $(dialogue).off("click");
  })
}

var events = {
  evilFlowey: function(){
    dialogue.editOptions({noskip: true, nonext: true, voice: "fe"});
    dialogue.go();
    $("#kill-flowey").click(function(){dialogue.start();})
    return("");
  },
  noEvilFlowey: function(){
    dialogue.editOptions({noskip: false, nonext: false});
  }
}

function bs(r){
  $(".blur").show();
  return(r);
}

function hOI(){
  dialogue.id = "intro";
  dialogue.write("* Howdy!   \\b:;* I'm \\c:y;FLOWEY\\</span>;.    \\b:;* \\c:y;FLOWEY\\</span>; the \\c:y;FLOWER\\</span>;!", function(){
    bs();
    ybf.play();
    inst();
  })
    .enableFace()
    .changeSprite("/floe.gif")
    .write("* Hmmm...")
    .write("* Have you played \\<a href='//undertale.com'>;UNDERTALE\\</a>; yet?   \\b:;* I hope so!")
    .write("* After all, this whole thing is a \\b:;\\ :4;spoiler.")
    .write("* And I'd like to have some fun with \\b:;\\ :4;you before it's too late...   \\b:;* So go play it!")
    .write("* Anyway, you're new here, right?   \\b:;* Little old me will have to show \\b:;\\ :4;you around!")
    .write("* This is a navigation bar.   \\b:;* It's pretty self-explanatory.", function(){
      dialogue.position = "bottom";
      $(".action-strip").addClass("raisedImportance");
      $(dialogue).addClass("raisedImportance");
    })
    .write("* However, you can also press the \\b:;\\ :4;left and right arrow keys or \\b:;\\ :4;swipe to change pages.")
    .write("* At least, once you get to a page.\\w:300;\\b:;* There's a big, long intro first.")
    .write("* Also, to skip dialogue, you can \\b:;\\ :4;press “x.”", function(){
      dialogue.position = "center";
      $(".action-strip").removeClass("raisedImportance");
      $(dialogue).removeClass("raisedImportance");
    })
    .write("* Just remember, you often won't be \\b:;\\ :4;able to skip.")
    .write("* With that, you could start \\b:;\\ :4;reading the story!")
    .write("\\<a class='material-icons' id='kill-flowey' onclick='dialogue.start()'>highlight_off</a>;\\shake:300;\\w:100;* But I'm not going to let you!", function(){
      events.evilFlowey();
      ybf.stop();
      dialogue.changeSprite("/grin.gif");
    })
    .write("* Hee hee hee!   \\b:;* You think software can get rid of \\b:;\\ :4;me?", function(){
      events.noEvilFlowey();
      dialogue.changeSprite("/evil2.gif");
    })
    .write("* What an idiot!   \\b:;* It doesn't matter, though.   \\b:;* I'm done!")
    .write("* See you, pal!\\b:;* Enjoy your story.")
    .start({voice: "flowey"})
    .done(function(){
      localStorage.hasPlayed = true;
      dialogue.visible = true;
      $(dialogue).fadeOut(1500, function(){
        location.reload()
        window.setTimeout(function(){
          intro();
          $(dialogue).fadeIn(2000);
        }, 1500)
      })
    })
    .position = "center";
}

function intro(){
  dialogue.id = "1";
  dialogue.write("* .\\bs(' ');\\ :2;.\\ :3;. \\w:1000;\\b:;* .\\ :3;.\\ :3;.")
    .disableFace()
    .write("\\w:1000;* Hello?\\w:4000;\\b:;* Where am I?\\w:500;")
    .write("\\w:2000;* .\\ :3;.\\ :3;.")
    .write("\\w:1000;* Oh!\\w:1000;\\playMusic:Memory;\\b:;* You, there, in the flowers!\\w:1000;\\b:;* Hello!")
    .write("\\w:2000;* Not much of a talker, huh?\\w:500;\\b:;* I wasn't, either, when I fell down.")
    .write("\\w:2000;* But you can hear me, right?")
    .write("\\w:1000;* Okay, good.\\w:1000;\\b:;* Hi, I'm " + $Story.name + ".\\w:500;\\b:;* Do you have a name?")
    .write("\\w:1500;* .\\ :3;.\\ :3;.\\w:500;\\b:;* No?\\w:1000;\\b:;* Alright.")
    .write("\\voice:fr;\\w:1000;* \\<span class='smol'>;(F-\\w:1000;Frisk...)\\</span>;")
    .write("\\voice:talk;* Frisk! \\w:500;\\b:;* That's a nice name.\\w:1000;\\b:;* Here, Frisk, let me help you up.")
    .write("* \\pauseMusic:Memory;AAAH!\\w:1000;\\playMusic:Memory;\\b:;* Uh, are you a ghost?\\w:1000;\\b:;* My hand phased through yours.")
    .write("* Oh.\\w:1000;\\b:;* It's all coming back now.")
    .write("\\w:2000;* \\stopMusic:Memory;\\shake:100;\\\"I'm\";\\w:150; \\shake:100;\\'dead.';")
    .write("* Well, it's not painful.\\b:;* C'mon, Frisk.\\w:1000;\\b:;* You want to get out of here I suppose.")
    .write("* Although, there are lots of nice people \\b:;\\ :4;here.\\w:1000;\\b:;* Are you sure you want to go?")
    .write("\\w:2000;* Okay, then.", function(){
      dialogue.editOptions({noskip: false});
    })
    .write("[" + $Story.name + " and Frisk journeyed across the underground.]")
    .write("[They met many friends and even " + $Story.name + "’s adoptive family.]")
    .write("[" + $Story.name + " was devastated to learn that Frisk would be their only companion.]")
    .write("[They were but the imprint of someone from the past.]")
    .write("[Yet " + $Story.name + " pushed to help Frisk in any way they could.]")
    .write("[As time passed, though, they had the weirdest feeling…]")
    .write("\\w:2000;[…that they didn’t feel anything at all.]")
    .write("[No compassion, no joy, no will to live.]")
    .write("[Even though they were already dead.]")
    .write("[At the end of it all, " + $Story.name + " felt nothing but regret even for Asgore, when Flowey pummeled him with his deadly pellets.]")
    .write("[Frisk was determined.\\w:1500;\\b:;And " + $Story.name + " was bored.]")
    .write("[And so went Frisk’s first run.\\w:2500;\\b:;But it was only the first.]")
    .start({noskip: true, voice: "talk"})
    .done(function(){
      $Story._next();
    })
    .position = "center";
}

$Aud.load(["Memory"]);

function ld(){
  if(dialogue.id == undefined){
    if(localStorage.hasPlayed){
      intro();
    }
    else{
      hOI();
    }
    Materialize.toast("Part 1", 4000, "mon");
  }
  else if (dialogue.id == "intro" || dialogue.id == "1"){
    console.log("You're back!");
  }
  else{
    history.back();
  }
}

dialogue.voice.add(["flowey", "fe", "talk", "fr"], "wav");
