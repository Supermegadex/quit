<style>
.ih {
    position: absolute;
    width: 100%;
    height: 200px;
    vertical-align: middle;
    transform: translate(0px, 140px);
    font-size: 25px;
    color: white;
    text-align: center;
}
#kill-flowey {
  position: absolute;
  right: 2px;
  top: 2px;
}
</style>

<p><span class="sans">we're not done, yet, flower.</span></p>

<script>
var jjj = new window.keypress.Listener();
var kkk = document.createElement("div");
kkk.style.position = "fixed";
kkk.style.width = "100%";
kkk.style["z-index"] = 2147430000
kkk.innerHTML = "<span class='ih mon'>Press “z” or tap in the box to continue.</span>";
var lll;
var mmm = true;

function inst(){
  document.body.appendChild(kkk);
  lll = window.setInterval(function(){
    if(mmm){
      mmm = false;
      $(kkk).hide();
    }
    else{
      mmm = true;
      $(kkk).show();
    }
  }, 1000);
  jjj.simple_combo("z", function(){
    window.clearInterval(lll);
    $(kkk).hide();
    $(dialogue).off("click");
  });
  $(dialogue).click(function(){
    window.clearInterval(lll);
    $(kkk).hide();
    $(dialogue).off("click");
  })
}

var events = {
  evilFlowey: function(){
    dialogue.editOptions({noskip: true, nonext: true, voice: "fe"});
    dialogue.go();
    $("#kill-flowey").click(function(){dialogue.start();})
    return("");
  },
  noEvilFlowey: function(){
    dialogue.editOptions({noskip: false, nonext: false});
  }
}

function bs(r){
  $(".blur").show();
  return(r);
}

function hOI(){
  dialogue.write("* Howdy!   \\b:;* I'm \\c:y;FLOWEY\\</span>;.    \\b:;* \\c:y;FLOWEY\\</span>; the \\c:y;FLOWER\\</span>;!", function(){
    bs();
    ybf.play();
    inst();
  })
    .enableFace()
    .changeSprite("/floe.gif")
    .write("Hmmm...")
    .write("* Have you played \\<a href='//undertale.com'>;UNDERTALE\\</a>; yet?   \\b:;* I hope so!")
    .write("* After all, this whole thing is a spoiler.")
    .write("* And I'd like to have some fun with you before it's too late...   \\b:;* So go play it!")
    .write("* Anyway, you're new here, right?   \\b:;* Little old me will have to show you around!")
    .write("* This is a navigation bar.   \\b:;* It's pretty self-explanatory.", function(){
      dialogue.position = "bottom";
    })
    .write("* However, you can also press the left and right arrow keys or swipe left and right to change pages.")
    .write("* At least, once you get to a page.\\w:300;\\b:;* There's a big, long intro first.")
    .write("* Also, to skip dialogue, you can press “x.”", function(){
      dialogue.position = "center";
    })
    .write("* Just remember, you often won't be able to skip.")
    .write("* With that, you could start reading the story!")
    .write("\\<a class='material-icons' id='kill-flowey' onclick='dialogue.start()'>highlight_off</a>;\\shake:300;\\w:100;* But I'm not going to let you!", function(){
      events.evilFlowey();
      ybf.stop();
      dialogue.changeSprite("/grin.gif");
    })
    .write("* Hee hee hee!   \\b:;* You think software can get rid of me?", function(){
      events.noEvilFlowey();
      dialogue.changeSprite("/evil2.gif");
    })
    .write("* What an idiot!   \\b:;* It doesn't matter, though.   \\b:;* I'm done!")
    .write("* See you, pal!\\b:;\\b:;* Enjoy your story.")
    .start({voice: "flowey"})
    .done(function(){
      localStorage.hasPlayed = true;
      dialogue.visible = true;
      $(dialogue).fadeOut(1500, function(){
        window.setTimeout(function(){
          intro();
          $(dialogue).fadeIn(2000);
        }, 1500)
      })
    })
    .position = "center";
}

function intro(){
  dialogue.write("* .\\bs(' ');\\ :2;.\\ :3;. \\w:1000;\\b:;* .\\ :3;.\\ :3;.")
    .disableFace()
    .write("\\w:1000;* Hello?\\w:4000;\\b:;* Where am I?\\w:500;")
    .write("\\w:2000;* .\\ :3;.\\ :3;.")
    .write("\\w:1000;* Oh!\\w:1000;\\b:;* You, there!\\w:1000;\\b:;* Hello!")
    .write("\\w:2000;* Not much of a talker, huh?\\w:500;\\b:;* I wasn't, either, when I fell down.")
    .write("\\w:2000;* You can hear me, though, right?")
    .write("\\w:1000;* Okay, good.\\w:1000;\\b:;* Hi, I'm " + $Story.name + ".\\w:500;\\b:;* Do you have a name?")
    .write("\\w:1500;* .\\ :3;.\\ :3;.\\w:500;\\b:;* No?\\w:1000;\\b:;* Alright.")
    .write("\\voice:fr;\\w:1000;* \\<span class='smol'>;(F-\\w:1000;Frisk...)\\</span>;")
    .write("\\voice:talk;* Frisk! \\w:500;\\b:;* That's a nice name.\\w:1000;\\b:;* Here, Frisk, let me help you up.")
    .write("* \\'SHIT!';\\w:1000;\\b:;* Uh, are you a ghost?\\w:1000;\\b:;* My hand phased through yours.")
    .write("* Oh.\\w:1000;\\b:;* It's all coming back now.")
    .write("\\w:2000;* \\shake:100;\\\"I'm\";\\w:150; \\shake:100;\\'dead.';")
    .write("* C'mon, Frisk.\\w:1000;\\b:;* You want to get out of here I suppose.")
    .write("* Although, there are lots of nice people here.\\w:1000;\\b:;* Are you sure you want to go?")
    .write("\\w:2000;* Okay, then.", function(){
      dialogue.editOptions({noskip: false});
    })
    .write("[Chara and Frisk journeyed across the underground.]")
    .write("[They met many friends and even Chara’s old family.]")
    .write("[Yeah, Chara had a breakdown when they realized they couldn’t talk to anyone but Frisk.]")
    .write("[They were but the imprint of someone from the past.]")
    .write("[Yet Chara pushed to help Frisk in any way they could.]")
    .write("[As time passed, though, they had the weirdest feeling…]")
    .write("\\w:2500;[…that they didn’t feel anything at all.]")
    .write("[No compassion, no joy, no will to live.]")
    .write("[Even though they were already dead.]")
    .write("[At the end of it all, Chara felt nothing even for Asgore, when Flowey pummeled him with his deadly pellets.]")
    .write("[Frisk was determined.\\w:1500;\\b:;And Chara was bored.]")
    .write("[And so went Frisk’s first run.\\w:3000;\\b:;But it was only the first.]")
    .start({noskip: true, voice: "talk"})
    .done(function(){
      $Story._next();
    })
    .position = "center";
}

function ld(){
  if(dialogue.waiting.length == 0){
    if(localStorage.hasPlayed){
      intro();
    }
    else{
      hOI();
    }
    Materialize.toast("Part 1", 4000, "mon");
  }
  else{
    history.back();
  }
}

dialogue.voice.add(["flowey", "fe", "talk", "fr"], "wav");
