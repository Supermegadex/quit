<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Thing</title>
    <style>
      body, div, canvas {
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
    <div id="game"></div>
    <script src="/js/jquery.js" charset="utf-8"></script>
    <script src="/game/crafty.js" charset="utf-8"></script>
    <script type="text/javascript">
      $(function() {
        var assetsObj = {
          "sprites": {
            // This spritesheet has 16 images, in a 2 by 8 grid
            // The dimensions are 832x228
            "/game/fsprmin.png": {
              // This is the width of each image in pixels
              tile: 76,
              // The height of each image
              tileh: 116,
              // padding
              // We give names to three individual images
              map: {
                friskd: [0, 0],
                frisku: [0, 1]
              }
            }
          }
        };

        Crafty.load(assetsObj, function(){ console.log("ready") })
        Crafty.init(window.innerWidth, window.innerHeight, document.getElementById('game'));

        window.g = {
          keys: {
            up: false,
            down: false,
            left: false,
            right: false
          },
          keys_old: {
            up: false,
            down: false,
            left: false,
            right: false
          }
        }

        $(document).on("keydown", function(e) {
          switch (e.key) {
            case "ArrowUp":
              g.keys.up = true
              break;
            case "ArrowDown":
              g.keys.down = true
              break;
            case "ArrowLeft":
              g.keys.left = true
              break;
            case "ArrowRight":
              g.keys.right = true
              break;
            default:
              break;
          }
        })
        $(document).on("keyup", function(e) {
          switch (e.key) {
            case "ArrowUp":
              g.keys.up = false
              break;
            case "ArrowDown":
              g.keys.down = false
              break;
            case "ArrowLeft":
              g.keys.left = false
              break;
            case "ArrowRight":
              g.keys.right = false
              break;
            default:
              g.keys.right = false
              g.keys.left = false
              g.keys.up = false
              g.keys.down = false
              break;
          }
          if (g.keys.up) {
            frisk.animate("frisku", -1)
          }
          if (g.keys.down) {
            frisk.animate("friskd", -1)
          }
          if (g.keys.left) {
            frisk.animate("friskl", -1)
          }
          if (g.keys.right) {
            frisk.animate("friskr", -1)
          }
        })

        var square = Crafty.e('2D, DOM, Color, Solid');
          square.attr({
            x: 100,
            y: 10,
            w: 100,
            h: 100
          }).color('red');

        square.origin("center")

        window.frisk = Crafty.e('2D, DOM, Color, Fourway, friskd, Keyboard, SpriteAnimation, Collision, Frisk')
          .attr({x: 0, y: 0, w: 38, h: 58})
          .fourway(200)
          .bind("EnterFrame", function() {
            g.keys_old = g.keys
          })
          .bind('KeyDown', function(e) {
            if(e.key == Crafty.keys.LEFT_ARROW) {
              frisk.animate("friskl", -1)
            } else if (e.key == Crafty.keys.RIGHT_ARROW) {
              frisk.animate("friskr", -1)
            } else if (e.key == Crafty.keys.UP_ARROW) {
              frisk.animate("frisku", -1)
            } else if (e.key == Crafty.keys.DOWN_ARROW) {
              frisk.animate("friskd", -1)
            }
          });
        frisk.reel("friskd", 500, [
          [1, 0], [2, 0]
        ])
        frisk.reel("downs", 500, [
          [1, 0]
        ])
        frisk.reel("friskl", 500, [
          [0, 3], [1, 3]
        ])
        frisk.reel("lefts", 500, [
          [0, 3]
        ])
        frisk.reel("frisku", 500, [
          [1, 1], [2, 1]
        ])
        frisk.reel("ups", 500, [
          [1, 1]
        ])
        frisk.reel("friskr", 500, [
          [0, 2], [1, 2]
        ])
        frisk.reel("rights", 500, [
          [0, 2]
        ])
        frisk.addComponent("Collision").bind('Moved', function(from) {
          //console.log(from)
          if(this.hit('Solid')) {
             console.log(from)
             frisk[from.axis] = from.oldValue
          }
        });
      })
    </script>
  </body>
</html>
