<link rel="import" href="polymer/polymer.html">
<dom-module id="story-box">
    <template>
        <style>
            .card-content {
                width: 100%;
                height: 100%;
                padding-bottom: 80px !important;
            }
            .card-action {
                position: fixed !important;
                bottom: 0;
                left: 0;
                right: 0;
                width: 100%;
            }
            .nxt {
                position: absolute;
                right: 4px;
            }
        </style>
        <div class="card blue-grey darken-1">
            <div class="card-content white-text">
              <span class="card-title"><h3>Part {{chapter}}</h3></span>
              <div class="flow-text" id="content" style="text-indent: 40px !important;">Hmmm....Something didn't work! If you see this, Your browser might not support AJAX, but that's incredibly rare. I probably messed up the code somewhere. Check this out later to see if it's working.<p>Another possibility is that your browser (interestingly, Chrome seems to be doing this) is trying to load a necessary part of the code before it's ready. If it is, <a href="javascript:chapter(2); chapter(1)">clicking this</a> should make it work properly.</p><p>[update] Ugh! Chrome! You're supposed to be so great! Why, then, do you not recognize that "chapters" is an EXPLICITLY-DEFINED ATTRIBUTE!!! Sorry, Chrome users, but you're going to have to use the "chapters" menu on the navbar to navigate, not the "next" button for now or just use another browser for a better experience. ¯\_(ツ)_/¯</p><p>The VERY BEST experience is found on Microsoft Edge and Firefox for Windows. It also works on mobile WebKit (any browser running on iOS), but audio transitioning is EXTREMELY choppy. I have not tested it on Android, but I assume it works pretty well.</p></div>
            </div>
            <div class="card-action blue-grey">
              <a class="waves-effect waves-pink btn-flat lst disabled" on-click="_previous">Previous</a><a class="waves-effect waves-pink btn-flat nxt" on-click="_next">Next</a>
            </div>
          </div>
    </template>
    <script>
    /* global Polymer */
    
        Polymer({
            is: "story-box",
            properties: {
                chapter: {
                    type: Number,
                    observer: "_loadStory",
                    value: 1
                },
                chapters: Number,
                name: {
                    type: String,
                    observer: "_chara",
                    value: "Chara"
                }
            },
            ready: function(){
                this._loadStory("TL", "DR");
                this.chapters = this.chapters;
            },
            _loadStory: function(TL, DR){
                var ch = this.chapter;
                var na = this.name;
                $.ajax("/chapter/" + ch + ".html").done(function(c){
                    window.scrollTo(0,0);
                    $("#content").html(c);
                    $(".chara").html(na);
                })
            },
            _chara: function(){
                $(".chara").html(this.name);
            },
            _next: function(){
                if(this.chapter < this.chapters){
                    this.chapter = this.chapter + 1;
                }
                if(this.chapter == this.chapters){
                    $(".nxt").addClass("disabled");
                }
                $(".lst").removeClass("disabled");
            },
            _previous: function(){
                if(this.chapter > 1){
                    this.chapter--;
                }
                if(this.chapter == 1){
                    $(".lst").addClass("disabled");
                }
                $(".nxt").removeClass("disabled");
            }
        })
        
    </script>
</dom-module>